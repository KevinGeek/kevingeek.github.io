<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Algorithm,åˆ†å¸ƒå¼," />




  


  <link rel="alternate" href="/atom.xml" title="å°é£ä¾ " type="application/atom+xml" />






<meta name="description" content="é˜¿å“²æ˜¯æ‘ä¸œè¾¹çš„å¤§æˆ·ï¼Œä»–æœ‰ä¸€ä¸ªç‰¹åˆ«å‰å®³çš„ç®¡å®¶ï¼Œèƒ½è¯´ä¼šé“ï¼Œæ™ºå•†è¶…äººï¼Œè¯´åˆ°è‰è“é£æ³¢â€¦">
<meta property="og:type" content="article">
<meta property="og:title" content="è‹¦å‘½ç®¡å®¶ä¹‹å·§è§£è‰è“é£æ³¢">
<meta property="og:url" content="http://kevingeek.github.io/2017/02/19/Stawberry/index.html">
<meta property="og:site_name" content="å°é£ä¾ ">
<meta property="og:description" content="é˜¿å“²æ˜¯æ‘ä¸œè¾¹çš„å¤§æˆ·ï¼Œä»–æœ‰ä¸€ä¸ªç‰¹åˆ«å‰å®³çš„ç®¡å®¶ï¼Œèƒ½è¯´ä¼šé“ï¼Œæ™ºå•†è¶…äººï¼Œè¯´åˆ°è‰è“é£æ³¢â€¦">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-02-19T10:24:50.000Z">
<meta property="article:modified_time" content="2020-04-09T04:19:33.058Z">
<meta property="article:author" content="kevin">
<meta property="article:tag" content="Algorithm">
<meta property="article:tag" content="åˆ†å¸ƒå¼">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://kevingeek.github.io/2017/02/19/Stawberry/"/>





  <title>è‹¦å‘½ç®¡å®¶ä¹‹å·§è§£è‰è“é£æ³¢ | å°é£ä¾ </title>
  








<meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°é£ä¾ </span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kevingeek.github.io/2017/02/19/Stawberry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kevin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°é£ä¾ ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">è‹¦å‘½ç®¡å®¶ä¹‹å·§è§£è‰è“é£æ³¢</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-19T18:24:50+08:00">
                2017-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index">
                    <span itemprop="name">æ—¥å¸¸</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>é˜¿å“²æ˜¯æ‘ä¸œè¾¹çš„å¤§æˆ·ï¼Œä»–æœ‰ä¸€ä¸ªç‰¹åˆ«å‰å®³çš„ç®¡å®¶ï¼Œèƒ½è¯´ä¼šé“ï¼Œæ™ºå•†è¶…äººï¼Œè¯´åˆ°è‰è“é£æ³¢â€¦</p>
<a id="more"></a>


<h1 id="äº‹èµ·"><a href="#äº‹èµ·" class="headerlink" title="äº‹èµ·"></a>äº‹èµ·</h1><p>è€çˆ·å¹³æ—¥æ²¡å•¥çˆ±å¥½ï¼Œå¹´å‰ä¸‹è‹æ­æ—¶å€™ç¢°å·§å°äº†ä¸€æ¬¡è‰è“ï¼Œè‡³æ­¤æ¯æ—¥å¿µå¿µä¸å¿˜ï¼Œæ‹›æ¥ç®¡å®¶â€¦</p>
<h2 id="åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†"><a href="#åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†" class="headerlink" title="åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†"></a>åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†</h2><p>  å˜´é¦‹ä¹Ÿæœ‰è®²ç©¶ï¼Œä¸æ˜¯èƒ¡åƒæµ·å–ï¼Œå’±ä»¬è¦æŒç»­æ€§å‘å±•â€¦<br>  è‰è“è¿™ç‰©ä»¶ï¼Œè¿™å¹´ä»£ä¹Ÿæ²¡å†°ç®±ä»€ä¹ˆçš„ï¼Œæœ€æ–°é²œçš„å°±æ˜¯æ¯æ—¥é‡‡æ‘˜ï¼Œè€çˆ·åšçš„é•¿è¿œæ‰“ç®—ï¼Œæ¯æ—¥ä¸€é†’å°±å¯¹è‰è“å¿ƒå¿ƒå¿µå¿µï¼Œæ‰€ä»¥å•Šï¼Œå°±æƒ³è¶Šæ—©è¶Šå¥½ï¼Œæ™šæ¥ä¸€ç‚¹ä¹Ÿæ²¡å…³ç³»ï¼Œä½†æ˜¯å¿…é¡»æ˜¯ä»Šå¤©æ‘˜çš„æ‰è¡Œï¼Œä½†æ˜¯ä¸€å¤©éƒ½æ²¡åƒåˆ°å¥½è‰è“ï¼Œæˆ‘å¯æ˜¯è¦å‘é£™å“¦ï¼<br>  è¿˜æœ‰ï¼Œè¿™è‰è“è™½å¥½ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½è´ªæ¯å“¦â€¦å•Šå‘¸ï¼Œä¸èƒ½å¤šåƒï¼Œæ¯æ—¥ä¸€è¢‹æ˜¯ä¸ºæœ€å¥½ï¼Œä¹‹åæ¥çš„ï¼Œå°±æŠŠä»–ä»¬é€€æ‰å§ï¼</p>
<h2 id="è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ"><a href="#è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ"></a>è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ</h2><p>å¯¹äºè€çˆ·çš„æƒ³æ³•ï¼Œç®¡å®¶è‡ªç„¶æ˜¯æ‘¸å¾—é€å½»ï¼Œç¨ä½œç›˜ç®—ï¼Œå°±çŸ¥é“è€çˆ·æƒ³çš„æ˜¯å•¥</p>
<ol>
<li>æ¯å¤©éƒ½éœ€è¦æ¶ˆè€—ä¸€æ‰¹è‰è“(å°½æœ€å¤§åŠªåŠ›)</li>
<li>æ¯å¤©ä»…åƒä¸€æ‰¹è‰è“</li>
<li>åªåƒå½“æ—¥æœ€æ–°é²œçš„ã€è´¨é‡è¿‡å…³çš„è‰è“ï¼Œè‡³äºæ˜¯è°æä¾›çš„å¹¶ä¸é‡è¦</li>
<li>å¦‚æœæœ‰å¤šä½™çš„æˆ–è€…ä¸åˆæ ¼çš„è‰è“ï¼Œåˆ™éœ€è¦æŠŠä»–ä»¬å¤„ç†æ‰(é€€è´§)</li>
</ol>
<h2 id="å¬é›†å•†å®¶"><a href="#å¬é›†å•†å®¶" class="headerlink" title="å¬é›†å•†å®¶"></a>å¬é›†å•†å®¶</h2><p>ä»»åŠ¡å©å’ä¸‹å»ï¼Œè®©ç®¡å®¶ä¸€æ‰‹æ“åŠï¼Œè€æ¿æå‡ºäº†éœ€æ±‚ï¼Œé‚£ç®¡å®¶å°±åªèƒ½è·‘è·‘è…¿äº†ï½ è¦æ‹¿åˆ°è‰è“ï¼Œé‚£å¾—é¦–å…ˆè”ç³»ä¸€ä¸‹è‰è“ä¾›åº”å•†æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µ</p>
<p>å‡ æ—¥ä¹‹åï¼Œå¾ˆå¿«å°±æœ‰äº†æ¶ˆæ¯ï¼Œè¿™å‡ å®¶ä¾›åº”å•†ï¼Œå› ä¸ºè‰è“å±äºç°æ‘˜ï¼Œæ¯æ—¥çš„æƒ…å†µéƒ½ä¸ä¸€æ ·ï¼Œä¾›åº”å•†æ¯å¤©é€æ¥éƒ½è´§ç‰©è´¨é‡ä¹Ÿéƒ½å‚å·®ä¸é½ï¼Œéœ€è¦ç®¡å®¶ä¸€ä¸€éªŒè¿‡<br>å¦‚æœè´§ç‰©è´¨é‡ä¸è¡Œï¼Œé‚£ä¹ˆå°±åªèƒ½é€€è´§å•¦ï¼Œåˆæˆ–è€…æˆ‘ä»¬è€çˆ·å½“æ—¥åªèƒ½åƒè¿‡è‰è“äº†ï¼Œé‚£ä¹ˆæŠ±æ­‰ï¼Œä½ è¿™æ‰¹è´§æˆ‘åªèƒ½é€€å•¦ï¼Œè¦æ˜¯ä½ æ¥çš„æ—¶å€™ï¼Œç®¡å®¶è¿˜åœ¨éªŒä¸Šå®¶çš„è´§ï¼Œé‚£ä½ å¯ä»¥ç¢°ç¢°è¿æ°”ï¼Œä¸‡ä¸€ä¸Šå®¶çš„è´§ç‰©ä¸è¿‡å…³å‘¢ï¼Œæ˜¯å§ï½</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œå¸‚åœºç«äº‰çœŸæ˜¯æ¿€çƒˆå‘€ï¼</p>
<p>é‚£ä¹ˆæç‚¼ä¸€ä¸‹ï¼š</p>
<ol>
<li>ä¸ä¿è¯æ¯æ—¥éƒ½æœ‰è´§ç‰©</li>
<li>ä¸ä¿è¯è´§ç‰©çš„è´¨é‡</li>
<li>ä¸ä¿è¯åˆ°è´§æ—¶é—´</li>
<li>æ¥å—é€€è´§</li>
<li>ä¾›åº”å•†åœ¨è´§ç‰©é€åˆ°ä¹‹å‰ï¼Œå¹¶ä¸çŸ¥æ™“è€çˆ·ä»Šæ—¥æ˜¯å¦å·²ç»äº«ç”¨äº†è‰è“</li>
</ol>
<p>å—¯ï¼Œä»»æ€§çš„ä¾›åº”å•†æä¾›çš„æœåŠ¡è¿˜çœŸæ˜¯ä¸æ€ä¹ˆå¯é å•Šï¼Œä½†æ˜¯è¿™æ€»éš¾ä¸ä½èªæ˜çš„ç®¡å®¶ï¼Œå’‹ä¸€çœ‹ï¼Œè™½ç„¶æ¯ä¸€å®¶è´§ç‰©æä¾›å•†å¹¶ä¸èƒ½æä¾›å®Œå…¨å¯é çš„æœåŠ¡ï¼Œä½†æ˜¯æˆ‘å¤šå–Šå‡ å®¶ä¸€èµ·ä¸Šï¼Œé‚£ä¹ˆè€çˆ·çš„éœ€æ±‚è¿˜æ˜¯å¯ä»¥å°½é‡æ»¡è¶³çš„å˜›ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œç®¡å®¶å°±è¢«è‡ªå·±çš„èªæ˜æ‰æ™ºé”æŠ˜æœäº†ï¼Œå¿ƒé‡Œè¿˜æœ‰ç‚¹å°æ¿€åŠ¨å‘¢ (à²¡Ï‰à²¡)hiahiahia</p>
<p>å¿ƒä¸­ä¸€é˜µç›˜ç®—ä¹‹åï¼Œé€šçŸ¥ä¾›åº”å•†ä»¬å¬é›†åˆ°é™¢ä¸­å¼€äº†ä¸€æ¬¡é›†ä½“ä¼šè®®â€¦.</p>
<h1 id="ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š"><a href="#ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š" class="headerlink" title="ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š"></a>ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š</h1><p>ä¼—å•†å®¶ï¼Œä»Šæ—¥å°†å¤§å®¶å¬é›†åˆ°æ­¤ï¼Œæ˜¯ä¸ºäº†é€šçŸ¥å„å•†å®¶ä¹‹åå’±ä»¬çš„ç»Ÿä¸€ä¾›è´§æ–¹å¼ï¼Œä¸€æ–¹é¢å°½é‡ä¿è¯è€çˆ·çš„è¦æ±‚ï¼Œä¸€æ–¹é¢å‘¢ï¼Œä¹Ÿæ˜¯å’Œå¤§å®¶æ‰“ä¸ªæ‹›å‘¼ï¼Œå’±ä»¬ä»¥åå°±æŒ‰ç…§è¿™ä¸ªæ³•å­æ¥ï¼Œäº’é€šæœ‰æ— å˜›</p>
<p>ä¹‹åæ¯æ—¥ï¼Œè‹¥å„ä½è´§ç‰©åˆ°åï¼Œå¯å°†è´§ç‰©å…ˆç½®æ”¾äºé™¢ä¸­ï¼Œç„¶åç”±çŸ¥æ™“æˆ‘ï¼Œå¾…æˆ‘æ¥å¯¹è´§ç‰©è¿›è¡ŒéªŒæ”¶ï¼ŒéªŒæ”¶é€šè¿‡ä¹‹åï¼Œå‘ä½ å‘æ”¾å½“æ—¥æ¬¾é¡¹ã€‚è‹¥é€šçŸ¥æˆ‘æ—¶ï¼Œæˆ‘å·²æ‰¾åˆ°ä¸€æ‰¹æ–°é²œçš„è´§ç‰©ï¼Œé‚£ä¹ˆä½ è´§çš„æ–°é²œç¨‹åº¦ä¸å¦‚ä¸Šå®¶ï¼Œè‡ªç„¶æ˜¯è¾“äº†ï¼Œé‚£ä¹ˆæˆ‘å°±æ— æ³•ç»™ä½ æ¬¾é¡¹ï¼Œåªèƒ½å°†è´§é€€è¿˜ç»™ä½ ã€‚è‹¥æˆ‘è¿˜åœ¨éªŒè´§ï¼Œé‚£ä½ å¯ä»¥å†ç­‰ç­‰ï¼Œè‹¥ä¹‹å‰çš„è´§ç‰©ä¸åˆæ ¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç­‰ç­‰ï¼Œè‹¥ä¸Šå®¶çš„è´§ç‰©ä¸ç¬¦åˆè€çˆ·çš„è¦æ±‚ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥æ¥éªŒä½ çš„è´§å•¦ï½</p>
<p>å„å•†å®¶è§ç®¡å®¶æå‡ºå¦‚æ­¤å¦¥å–„çš„æ³¨æ„ï¼Œäº‹å°‘ï¼Œä¹Ÿä¸ç”¨å’Œåˆ«å®¶ä¼¤å’Œæ°”ï¼Œä¸€åˆ‡ä¹°å–å…¨å‡­æœ¬äº‹ï¼Œä¸€ä¸ªä¸€ä¸ªä¹Ÿæ‘©æ‹³æ“¦æŒï¼Œçº·çº·è¡¨ç¤ºèµåŒ</p>
<h1 id="å•æœºç‰ˆ"><a href="#å•æœºç‰ˆ" class="headerlink" title="å•æœºç‰ˆ"></a>å•æœºç‰ˆ</h1><p>ä¸€æ®µæ—¶æ—¥ä¹‹åï¼Œè€çˆ·å¦‚æ„¿åƒä¸Šäº†æƒ³è¦çš„è‰è“ğŸ“ï¼Œç®¡å®¶ä¹Ÿå°†æ­¤æ–¹æ³•è®°å½•äº†ä¸‹æ¥ï¼Œä»¥ä¾¿æ”¹è¿›ä¸å­¦ä¹  :)</p>
<p>å•†å®¶p1ã€p2å±äºé›†åˆP<code>(Provider)</code>ï¼Œå•†å®¶æä¾›çš„æœåŠ¡éƒ½æ˜¯åŒè´¨çš„ï¼Œå¯ä»¥å½’ä¸ºä¸€ç±»ï¼Œåˆ†åˆ«ä¸º</p>
<ol>
<li>é€è´§ deliver</li>
<li>éªŒè´§ validate</li>
<li>é€€è´§ takeBack</li>
</ol>
<p>è€Œç®¡å®¶g<code>(governor)</code>çš„çŠ¶æ€åˆ†ä¸ºå‡ ç§</p>
<ol>
<li>å°šæœªéªŒè´§ available</li>
<li>æ­£åœ¨éªŒè´§ validating</li>
<li>éªŒè´§ç»“æŸ unavailable</li>
</ol>
<p>é‚£ä¹ˆå•†å®¶æ‰€æ‰§è¡Œçš„æ­¥éª¤å¯ä»¥ç”¨å¦‚ä¸‹ä¼ªä»£ç è¡¨ç¤ºï¼š</p>
<pre class="line-numbers language-Java"><code class="language-Java">public class ProviderDeliver {

  public void dailyWork(Provider p, Governor g){}

  p.deliver();

  if (g.unavailable()) {
    p.takeBack();
    return ;
  }

  while (g.validating()) {
    // simply wait
  }

  if (g.available()) {
    p.validate();
  } else {
    p.takeBack();
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="åˆ†å¸ƒå¼ç‰ˆ"><a href="#åˆ†å¸ƒå¼ç‰ˆ" class="headerlink" title="åˆ†å¸ƒå¼ç‰ˆ"></a>åˆ†å¸ƒå¼ç‰ˆ</h1><p>å“å‘€ï¼Œè€çˆ·ä¸€é«˜å…´ï¼Œèµé‡‘ç»™å¾—ç‰¹åˆ«é«˜ï¼Œå„è·¯å•†å®¶æ¥è¸µè€Œè‡³ï¼Œç®¡å®¶è¦å¿™ä¸è¿‡æ¥äº†ï¼Œäºæ˜¯å©å’ä¸‹å»å‡ ä¸ªå®¶ä¸ï¼Œåˆ†åˆ«æ¥å¾…å•†æˆ·ï¼Œæ£€æŸ¥ä¾ç„¶ç”±ç®¡å®¶äº²è‡ªæ“ä½œï¼Œä½†å•†æˆ·æ— éœ€ç­‰å¾…ï¼Œä»…éœ€è¦å°†è´§ç‰©æ”¾åœ¨åºœä¸­ï¼Œé€€è´§ç”±å®¶ä¸å®Œæˆï¼Œè€Œå•†æˆ·ä¹Ÿä¸ç›´æ¥ä¸ç®¡å®¶æ¥è§¦ï¼Œç”±å®¶ä¸è´Ÿè´£å•†å®¶å’Œç®¡å®¶ä¹‹é—´çš„æ²Ÿé€šï¼Œç®¡å®¶é€šè¿‡åºœé‚¸ä¸­çš„æ——å¸œè¡¨ç¤ºè‡ªå·±ç›®å‰æ­£åœ¨éªŒè´§ã€ä¼‘æ¯ã€éªŒè´§å®Œæ¯•</p>
<p>é‚£ä¹ˆæ•´ä½“çš„æµç¨‹ä½œä¸€ä¸‹ç®€å•è½¬æ¢ï¼Œå¯¹å•†æˆ·æ¥è¯´ï¼Œæµç¨‹æ›´åŠ ç®€å•</p>
<pre class="line-numbers language-Java"><code class="language-Java">
/**
 *
 * Created by kevin on 20/02/2017.
 */
public class Strawberry {

    static AtomicInteger errorCount = new AtomicInteger(0);
    static AtomicInteger takeBackCount = new AtomicInteger(0);
    static AtomicInteger consumedCount = new AtomicInteger(0);
    static AtomicInteger acceptedCount = new AtomicInteger(0);
    static Random r = new Random();
    static class ProviderDeliver2 {

        private Provider p;

        ProviderDeliver2(String name) {
            this.p = new Provider(name);
        }

        void dailyWork(int day) {
            Merchandise m = p.deliver(); // è¿é€è´§ç‰©
            Worker worker = Worker.of(this, day); // éšä¾¿æ‰¾ä¸ªå®¶ä¸ï¼Œå¹¶æŠŠè´§ç‰©äº¤ç»™ä»–
            worker.process(m); //  å®¶ä¸æ¥å¤„ç†è´§ç‰©
        }

        void takeBack(Merchandise m) {
            int res = m.getTime().incrementAndGet();
            if (res == 1) {
                takeBackCount.incrementAndGet();
            } else if (res > 1) {
                System.out.println("fail! operate " + res );
                errorCount.incrementAndGet();
            }
        }
    }

    static class Worker {

        private Governor g;
        private ProviderDeliver2 pd2;

        Worker(ProviderDeliver2 pd2, Governor g) {
            this.pd2 = pd2;
            this.g = g;
        }

        static Worker of(ProviderDeliver2 pd2, int day) {
            return new Worker(pd2, Governor.getInstance(day));
        }

        void process(Merchandise m) {
            g.validate(this, m);
        }

        void takeBack(Merchandise m) {
            pd2.takeBack(m);
        }
    }

    static class Governor {

        private AtomicBoolean available = new AtomicBoolean(true);
        private AtomicBoolean validating = new AtomicBoolean(false);
        private Queue<Merchandise> queue = Queues.newConcurrentLinkedQueue();
        private int date;

        private static ConcurrentHashMap<Integer, Governor> MAP = new ConcurrentHashMap<>();

        static Governor getInstance(int day) {
            return MAP.computeIfAbsent(day, Governor::new);
        }

        boolean available() {
            return available.get();
        }

        private Governor(int date) {
            this.date = date;
        }

        void validate(Worker worker, Merchandise m) {
            try {
                if (!available()) {
                    worker.takeBack(m);
                    return;
                }

                this.addMerchandise(m);

                if (!validating.compareAndSet(false, true)) {
                    return;
                }

                if (!available()) {
                    cleanAll(worker);
                    return;
                }
                while (!queue.isEmpty()) {
                    Merchandise item = queue.poll();
                    if (available() && item.isGood()) {
                        available.set(false);
                        acceptedCount.incrementAndGet();
                    } else {
                        worker.takeBack(item);
                    }
                }
                validating.set(false);

            } finally {
                consumedCount.incrementAndGet();
            }
        }

        private void cleanAll(Worker worker) {
            while (!queue.isEmpty()) {
                Merchandise item = queue.poll();
                worker.takeBack(item);
            }
        }
        void addMerchandise(Merchandise m) {
            queue.add(m);
        }
    }

    public static class Provider {

        private String name;

        Provider(String name) {
            this.name = name;
        }

        Merchandise deliver() {
            return new Merchandise(this.name + System.nanoTime());
        }
    }

    static class Merchandise {

        private String name;
        private AtomicInteger time = new AtomicInteger(0);
        private long quality = r.nextInt(100);

        AtomicInteger getTime() {
            return time;
        }

        Merchandise(String name) {
            this.name = name;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;

            Merchandise that = (Merchandise) o;

            return name != null ? name.equals(that.name) : that.name == null;
        }

        @Override
        public int hashCode() {
            return name != null ? name.hashCode() : 0;
        }

        boolean isGood() {
//            return true;
            return quality < 80;
        }
    }

    public static void main(String[] args) throws InterruptedException {
        // æ¨¡ä»¿5ä¸ªå•†å®¶ï¼Œè¿ç»­æä¾›500æ—¥çš„æƒ…å†µ
        int k = 0;
        for (int day = 0; day < 500; day++) {
            int tmpDay = day;
            for (int i = 0; i < 5; i++) {
                new Thread(() -> new ProviderDeliver2(String.valueOf(tmpDay)).dailyWork(tmpDay)).start();
                k++;
            }
        }
        while (k != consumedCount.get()) {
            Thread.sleep(10);
        }
        System.out.println("done");
        System.out.println(errorCount.get()); //0
        System.out.println(takeBackCount.get()); //
        System.out.println(acceptedCount.get()); //
        System.out.println(consumedCount.get()); //
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Algorithm/" rel="tag"># Algorithm</a>
          
            <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"># åˆ†å¸ƒå¼</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/24/RateLimiter/" rel="next" title="é™æµä¹‹RateLimiter">
                <i class="fa fa-chevron-left"></i> é™æµä¹‹RateLimiter
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/01/hello-world/" rel="prev" title="2019, New Beginning">
                2019, New Beginning <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">kevin</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#äº‹èµ·"><span class="nav-number">1.</span> <span class="nav-text">äº‹èµ·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†"><span class="nav-number">1.1.</span> <span class="nav-text">åŸæ¥æ˜¯è€çˆ·å˜´é¦‹äº†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ"><span class="nav-number">1.2.</span> <span class="nav-text">è€çˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¬é›†å•†å®¶"><span class="nav-number">1.3.</span> <span class="nav-text">å¬é›†å•†å®¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š"><span class="nav-number">2.</span> <span class="nav-text">ä¸€ä¸ªæœˆé»‘é£é«˜çš„å¤œæ™š</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å•æœºç‰ˆ"><span class="nav-number">3.</span> <span class="nav-text">å•æœºç‰ˆ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#åˆ†å¸ƒå¼ç‰ˆ"><span class="nav-number">4.</span> <span class="nav-text">åˆ†å¸ƒå¼ç‰ˆ</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kevin</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
